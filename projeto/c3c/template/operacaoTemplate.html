<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Desk - C3C Workplace</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- √çcones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonte Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        c3c: {
                            blue: '#2978FF',
                            teal: '#1DDDBD',
                            dark: '#1a1a1a',
                            bg: '#F8FAFC'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #F8FAFC; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
        
        /* Anima√ß√£o do Cron√¥metro */
        .timer-pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Scrollbar fina */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Abas Internas Ativas */
        .tab-active {
            border-top: 2px solid #2978FF;
            background-color: white;
            color: #1a1a1a;
        }
        .tab-inactive {
            border-top: 2px solid transparent;
            color: #6B7280;
        }
        .tab-inactive:hover {
            background-color: white;
            color: #2978FF;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden bg-c3c-bg">

    <!-- 1. SIDEBAR -->
    <aside class="w-20 lg:w-64 bg-white border-r border-gray-100 flex flex-col z-20 transition-all duration-300">
        <div class="h-20 flex items-center justify-center lg:justify-start lg:px-8 border-b border-gray-50">
            <div class="w-8 h-8 bg-gradient-to-br from-[#2978FF] to-[#1DDDBD] rounded-lg flex items-center justify-center text-white font-bold text-xs">C3C</div>
            <span class="hidden lg:block ml-3 font-bold text-gray-800 tracking-wide text-lg">Workplace</span>
        </div>
        <nav class="flex-1 py-6 space-y-2">
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 text-gray-400 hover:bg-gray-50 transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="hidden lg:block font-medium text-sm">Vis√£o Geral</span>
            </a>
            <!-- Menu Ativo -->
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 bg-indigo-50 text-indigo-600 border-r-4 border-indigo-500 font-semibold transition-colors">
                <i data-lucide="headset" class="w-5 h-5"></i>
                <span class="hidden lg:block text-sm">Mesa de Opera√ß√µes</span>
            </a>
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 text-gray-400 hover:bg-gray-50 transition-colors">
                <i data-lucide="clock" class="w-5 h-5"></i>
                <span class="hidden lg:block font-medium text-sm">Minhas Horas</span>
            </a>
        </nav>
        
        <!-- Widget Status do Agente -->
        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-gray-500 uppercase">Meu Status</span>
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse" id="agent-status-led"></span>
            </div>
            <select id="agent-status-select" onchange="updateAgentStatus(this.value)" class="w-full text-xs border-gray-300 rounded p-1 bg-white text-gray-700 font-bold focus:ring-0 cursor-pointer">
                <option value="available">üü¢ Dispon√≠vel</option>
                <option value="busy">üî¥ Em Atendimento</option>
                <option value="break">‚òï Pausa</option>
            </select>
        </div>
    </aside>

    <!-- 2. MAIN CONTENT -->
    <main class="flex-1 flex flex-col relative w-full overflow-hidden">
        
        <!-- Header: Filas e Aloca√ß√£o -->
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shrink-0 shadow-sm z-10">
            <div class="flex items-center gap-4">
                <h1 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i data-lucide="layers" class="w-5 h-5 text-indigo-600"></i>
                    Gest√£o de Chamados
                </h1>
                <div class="h-6 w-px bg-gray-200"></div>
                
                <!-- Pills de Aloca√ß√£o -->
                <div class="flex gap-2">
                    <div class="flex items-center gap-2 px-3 py-1 bg-blue-50 border border-blue-100 rounded-full">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="text-xs font-bold text-blue-700">Squad Salesforce (N2)</span>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-1 bg-purple-50 border border-purple-100 rounded-full">
                        <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                        <span class="text-xs font-bold text-purple-700">Infraestrutura Geral</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-right">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">Produtividade Hoje</p>
                    <p class="text-sm font-bold text-gray-800">4h 15m (3 tickets)</p>
                </div>
            </div>
        </header>

        <!-- Content Area: Split View -->
        <div class="flex-1 flex overflow-hidden">
            
            <!-- COLUNA ESQUERDA: LISTAS (40%) -->
            <div class="w-[450px] flex flex-col border-r border-gray-200 bg-white">
                
                <!-- Abas de Navega√ß√£o -->
                <div class="flex border-b border-gray-200">
                    <button onclick="switchTab('my-tickets')" id="tab-my-tickets" class="flex-1 py-3 text-sm font-bold text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50 hover:bg-indigo-50 transition-colors">
                        Meus (<span id="count-my">2</span>)
                    </button>
                    <button onclick="switchTab('queue')" id="tab-queue" class="flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:bg-gray-50 transition-colors">
                        Fila (<span id="count-queue">5</span>)
                    </button>
                    <button onclick="switchTab('team')" id="tab-team" class="flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:bg-gray-50 transition-colors">
                        Equipe (<span id="count-team">3</span>)
                    </button>
                </div>

                <!-- Filtros R√°pidos -->
                <div class="p-3 border-b border-gray-100 flex gap-2 bg-white">
                    <input type="text" placeholder="Buscar ID ou Cliente..." class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button class="p-1.5 bg-gray-100 rounded-lg hover:bg-gray-200"><i data-lucide="filter" class="w-4 h-4 text-gray-600"></i></button>
                </div>

                <!-- Lista: MEUS CASOS -->
                <div id="list-my-tickets" class="flex-1 overflow-y-auto p-3 space-y-2 bg-gray-50/50">
                    <div onclick="loadTicket(1, 'my')" class="ticket-card cursor-pointer bg-white border border-l-4 border-l-green-500 border-gray-200 rounded-lg p-3 hover:shadow-md transition-all relative">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-600">#4505</span>
                            <span class="text-[10px] font-bold text-green-600 bg-green-50 px-2 rounded">Em Andamento</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Cria√ß√£o de Usu√°rio Salesforce</h4>
                        <div class="flex justify-between items-end">
                            <span class="text-[10px] text-gray-500 bg-gray-100 px-1.5 rounded">Tech Solutions</span>
                            <span class="text-[10px] text-gray-400">SLA: 4h</span>
                        </div>
                    </div>
                    <div onclick="loadTicket(3, 'my')" class="ticket-card cursor-pointer bg-white border border-l-4 border-l-yellow-400 border-gray-200 rounded-lg p-3 hover:shadow-md transition-all opacity-80">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-600">#4498</span>
                            <span class="text-[10px] font-bold text-yellow-600 bg-yellow-50 px-2 rounded">Aguardando Cliente</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">D√∫vida Relat√≥rio Leads</h4>
                        <div class="flex justify-between items-end">
                            <span class="text-[10px] text-gray-500 bg-gray-100 px-1.5 rounded">Banco Alpha</span>
                            <span class="text-[10px] text-gray-400">SLA: 2d</span>
                        </div>
                    </div>
                </div>

                <!-- Lista: FILA GERAL (Modo Leitura/Puxar) -->
                <div id="list-queue" class="hidden flex-1 overflow-y-auto p-3 space-y-2 bg-gray-50/50">
                    <div onclick="loadTicket(4502, 'queue')" class="cursor-pointer bg-white border border-l-4 border-l-red-500 border-gray-200 rounded-lg p-3 shadow-sm group hover:ring-2 ring-indigo-200">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-red-600">#4502 (Cr√≠tico)</span>
                            <span class="text-[10px] font-bold text-red-500 flex items-center gap-1"><i data-lucide="alert-circle" class="w-3 h-3"></i> SLA Vencido</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Erro 500 Checkout VTEX</h4>
                        <p class="text-xs text-gray-500 mb-2">Varejo Express</p>
                    </div>
                    <div onclick="loadTicket(4510, 'queue')" class="cursor-pointer bg-white border border-l-4 border-l-gray-300 border-gray-200 rounded-lg p-3 shadow-sm group hover:ring-2 ring-indigo-200">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-500">#4510</span>
                            <span class="text-[10px] font-bold text-gray-400">N√≠vel 1</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Reset de Senha AD</h4>
                        <p class="text-xs text-gray-500 mb-2">Tech Solutions</p>
                    </div>
                </div>

                <!-- Lista: EQUIPE (Modo Apoio) -->
                <div id="list-team" class="hidden flex-1 overflow-y-auto p-3 space-y-2 bg-gray-50/50">
                    <div onclick="loadTicket(9001, 'team')" class="cursor-pointer bg-white border border-l-4 border-l-blue-400 border-gray-200 rounded-lg p-3 shadow-sm hover:ring-2 ring-blue-200">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-600">#9001</span>
                            <div class="flex items-center gap-1">
                                <span class="w-4 h-4 rounded-full bg-blue-100 text-[8px] flex items-center justify-center font-bold text-blue-700">PL</span>
                                <span class="text-[10px] font-bold text-blue-600">Pedro Lima</span>
                            </div>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Lentid√£o API Salesforce</h4>
                        <p class="text-xs text-gray-500">Banco Alpha - Em an√°lise h√° 2h</p>
                    </div>
                </div>
            </div>

            <!-- COLUNA DIREITA: DETALHE & WORKFLOW (60%) -->
            <div class="flex-1 bg-gray-50 flex flex-col relative" id="ticket-workspace">
                
                <!-- Barra de Aviso (Contexto) -->
                <div id="context-banner" class="hidden px-4 py-2 text-xs font-bold text-center"></div>

                <!-- Barra de Ferramentas / Cron√¥metro -->
                <div class="bg-white border-b border-gray-200 p-4 shadow-sm z-20 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div id="active-ticket-indicator" class="hidden flex flex-col">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Ticket Atual:</span>
                            <span class="text-sm font-bold text-indigo-600" id="current-working-id">#4505</span>
                        </div>
                        <div class="h-8 w-px bg-gray-200 hidden" id="divider-timer"></div>
                        <!-- Cron√¥metro -->
                        <div class="flex items-center gap-2">
                            <div class="text-3xl font-mono font-bold text-gray-800 tracking-wider" id="timer-display">00:00:00</div>
                            <div class="flex gap-1" id="timer-controls">
                                <button id="btn-start" onclick="startTimer()" class="p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg shadow-sm transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                                </button>
                                <button id="btn-pause" onclick="pauseTimer()" class="hidden p-2 bg-yellow-400 hover:bg-yellow-500 text-white rounded-lg shadow-sm transition-transform active:scale-95">
                                    <i data-lucide="pause" class="w-5 h-5 fill-current"></i>
                                </button>
                                <button id="btn-stop" onclick="stopTimer()" class="hidden p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-sm transition-transform active:scale-95">
                                    <i data-lucide="square" class="w-5 h-5 fill-current"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√£o de A√ß√£o Principal (Din√¢mico) -->
                    <div id="main-action-area">
                        <div class="flex items-center gap-2">
                            <select id="ticket-status" class="bg-white border border-gray-300 text-gray-700 text-xs font-bold rounded p-2" disabled>
                                <option value="open">Aberto</option>
                                <option value="progress">Em Andamento</option>
                                <option value="pending">Aguardando</option>
                                <option value="resolved">Resolvido</option>
                            </select>
                            <button onclick="saveTicketChanges()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold px-4 py-2 rounded shadow-sm flex items-center gap-2 disabled:opacity-50" id="btn-save" disabled>
                                <i data-lucide="save" class="w-4 h-4"></i> Salvar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Conte√∫do do Ticket -->
                <div id="ticket-content-area" class="flex-1 overflow-y-auto p-6 hidden">
                    
                    <!-- Cabe√ßalho do Ticket -->
                    <div class="mb-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 leading-tight mb-2" id="detail-title">Titulo do Ticket</h1>
                                <div class="flex items-center gap-3 text-sm">
                                    <span class="bg-gray-200 text-gray-700 px-2 py-0.5 rounded font-mono font-bold" id="detail-id">#ID</span>
                                    <span class="flex items-center gap-1 text-gray-500"><i data-lucide="briefcase" class="w-3 h-3"></i> <span id="detail-client">Cliente</span></span>
                                    <span class="flex items-center gap-1 text-red-500 font-bold"><i data-lucide="clock" class="w-3 h-3"></i> <span id="detail-sla">SLA</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Abas Internas (Navega√ß√£o) -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[400px] flex flex-col">
                        <div class="flex border-b border-gray-200 bg-gray-50">
                            <button onclick="switchDetailTab('details')" id="tab-details" class="px-6 py-3 text-sm font-bold tab-active transition-colors">Detalhes & Hist√≥rico</button>
                            <button onclick="switchDetailTab('attachments')" id="tab-attachments" class="px-6 py-3 text-sm font-bold tab-inactive transition-colors">Anexos (2)</button>
                            <button onclick="switchDetailTab('metadata')" id="tab-metadata" class="px-6 py-3 text-sm font-bold tab-inactive transition-colors">Metadados</button>
                        </div>

                        <div class="p-6 flex-1 flex flex-col relative">
                            
                            <!-- TAB 1: DETALHES -->
                            <div id="view-details" class="flex-1 flex flex-col">
                                <div class="bg-blue-50/50 p-4 rounded-lg border border-blue-100 mb-6">
                                    <p class="text-xs font-bold text-blue-800 uppercase mb-2">Descri√ß√£o do Incidente</p>
                                    <p class="text-sm text-gray-700 leading-relaxed" id="detail-desc">...</p>
                                </div>

                                <div class="flex-1 overflow-y-auto space-y-4 mb-4 pr-2 max-h-[300px]" id="comments-timeline">
                                    <!-- Coment√°rios -->
                                </div>

                                <div class="mt-auto pt-4 border-t border-gray-100" id="comment-box">
                                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Adicionar Atualiza√ß√£o</label>
                                    <div class="flex gap-2">
                                        <textarea id="new-comment-text" class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none resize-none h-20" placeholder="Descreva o que foi feito..."></textarea>
                                        <button onclick="addComment()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 rounded-lg shadow-sm font-bold transition-colors">
                                            <i data-lucide="send" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB 2: ANEXOS (Novo) -->
                            <div id="view-attachments" class="hidden flex-1">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                    <!-- Anexo Mock -->
                                    <div class="group relative bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-col items-center justify-center hover:bg-white hover:shadow-md transition-all cursor-pointer">
                                        <i data-lucide="file-text" class="w-8 h-8 text-gray-400 group-hover:text-indigo-600 mb-2"></i>
                                        <span class="text-xs font-bold text-gray-700 text-center truncate w-full">log_erro_500.txt</span>
                                        <span class="text-[10px] text-gray-400">12 KB</span>
                                        <button class="absolute top-2 right-2 text-gray-300 hover:text-indigo-600"><i data-lucide="download" class="w-4 h-4"></i></button>
                                    </div>
                                    <div class="group relative bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-col items-center justify-center hover:bg-white hover:shadow-md transition-all cursor-pointer">
                                        <i data-lucide="image" class="w-8 h-8 text-gray-400 group-hover:text-indigo-600 mb-2"></i>
                                        <span class="text-xs font-bold text-gray-700 text-center truncate w-full">print_tela.png</span>
                                        <span class="text-[10px] text-gray-400">2.4 MB</span>
                                        <button class="absolute top-2 right-2 text-gray-300 hover:text-indigo-600"><i data-lucide="download" class="w-4 h-4"></i></button>
                                    </div>
                                </div>
                                
                                <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-50 transition-colors cursor-pointer">
                                    <i data-lucide="upload-cloud" class="w-8 h-8 mb-2"></i>
                                    <p class="text-sm font-medium">Arraste arquivos aqui ou clique para fazer upload</p>
                                </div>
                            </div>

                            <!-- TAB 3: METADADOS (Novo) -->
                            <div id="view-metadata" class="hidden flex-1">
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Prioridade</p>
                                        <span class="inline-flex items-center gap-1 bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded"><i data-lucide="alert-triangle" class="w-3 h-3"></i> Alta</span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Categoria</p>
                                        <span class="text-sm font-medium text-gray-800">Incidente / Software</span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Aberto Em</p>
                                        <span class="text-sm font-medium text-gray-800">22/12/2025 08:30</span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">SLA Vencimento</p>
                                        <span class="text-sm font-bold text-red-600">22/12/2025 12:30 (Vencido)</span>
                                    </div>
                                    <div class="col-span-2">
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Tags</p>
                                        <div class="flex gap-2">
                                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">#vtex</span>
                                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">#checkout</span>
                                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">#api-error</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="empty-workspace" class="flex-1 flex flex-col items-center justify-center text-gray-400 text-center opacity-60">
                    <i data-lucide="monitor" class="w-16 h-16 mb-4 text-gray-300"></i>
                    <h3 class="text-lg font-bold text-gray-500">Nenhum chamado selecionado</h3>
                    <p class="text-sm">Selecione um chamado da lista para visualizar.</p>
                </div>

            </div>
        </div>
    </main>

    <!-- Modal de Registro -->
    <div id="log-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300 p-4">
        <!-- (Conte√∫do Modal id√™ntico ao anterior) -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-xl">
                <h3 class="font-bold text-indigo-900 flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> Finalizar Sess√£o</h3>
            </div>
            <div class="p-6">
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 font-bold mb-1">Tempo Total</label>
                        <input type="text" id="modal-time" class="w-full border border-gray-300 rounded p-2 font-mono font-bold text-lg text-center bg-gray-50" readonly>
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 font-bold mb-1">Classifica√ß√£o</label>
                        <select class="w-full border border-gray-300 rounded p-2 text-sm bg-white"><option>Atendimento N2</option><option>Investiga√ß√£o</option></select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-xs text-gray-500 font-bold mb-1">Resumo</label>
                    <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm" value="Atendimento ticket..." id="log-summary">
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="closeLogModal()" class="px-4 py-2 text-gray-500 font-bold text-xs hover:bg-gray-100 rounded">Cancelar</button>
                    <button onclick="confirmLog()" class="px-4 py-2 bg-indigo-600 text-white font-bold text-xs rounded hover:bg-indigo-700 shadow-md">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerta Bloqueio -->
    <div id="alert-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm transform scale-95 transition-transform duration-300 border-l-4 border-red-500">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-3 text-red-600"><i data-lucide="alert-octagon" class="w-8 h-8"></i><h3 class="text-lg font-bold">A√ß√£o Bloqueada</h3></div>
                <p class="text-sm text-gray-600 mb-4" id="alert-message">Voc√™ j√° possui um chamado ativo para este cliente.</p>
                <div class="flex justify-end"><button onclick="closeAlert()" class="px-4 py-2 bg-gray-100 text-gray-700 font-bold text-sm rounded hover:bg-gray-200">Entendido</button></div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // --- DADOS ---
        const myTickets = {
            1: { id: '#4505', title: 'Cria√ß√£o de Usu√°rio', client: 'Tech Solutions', sla: '4h', desc: 'Novo colaborador comercial.', status: 'progress', comments: [] },
            3: { id: '#4498', title: 'D√∫vida Relat√≥rio', client: 'Banco Alpha', sla: '2d', desc: 'D√∫vida filtros mensais.', status: 'pending', comments: [] }
        };
        const queueTickets = {
            4502: { id: '#4502', title: 'Erro 500 Checkout VTEX', client: 'Varejo Express', sla: 'Vencido', desc: 'Cr√≠tico: Loja parada.', status: 'open' },
            4510: { id: '#4510', title: 'Reset Senha AD', client: 'Tech Solutions', sla: '8h', desc: 'Usu√°rio bloqueado.', status: 'open' }
        };
        const teamTickets = {
            9001: { id: '#9001', title: 'Lentid√£o API Salesforce', client: 'Banco Alpha', sla: '2h', desc: 'Lentid√£o intermitente.', status: 'progress', owner: 'Pedro Lima', comments: [{text: 'Analisando logs...', time: '10:00'}] }
        };

        let currentTicketId = null;
        let currentScope = 'my'; // 'my', 'queue', 'team'
        let timerInterval = null;
        let seconds = 0;
        let isRunning = false;

        // --- NAVEGA√á√ÉO ---
        function switchTab(tab) {
            ['my-tickets', 'queue', 'team'].forEach(t => {
                document.getElementById(`tab-${t}`).className = `flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${tab === t ? 'text-indigo-600 border-indigo-600 bg-indigo-50/50' : 'text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50'}`;
                document.getElementById(`list-${t}`).classList.toggle('hidden', tab !== t);
            });
        }

        function switchDetailTab(tabName) {
            ['details', 'attachments', 'metadata'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                const view = document.getElementById(`view-${t}`);
                if (t === tabName) {
                    btn.classList.add('tab-active');
                    btn.classList.remove('tab-inactive');
                    view.classList.remove('hidden');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                    view.classList.add('hidden');
                }
            });
        }

        // --- LOAD TICKET (Central Logic) ---
        function loadTicket(id, scope) {
            currentScope = scope;
            currentTicketId = id;
            
            // Dados
            let t;
            if(scope === 'my') t = myTickets[id];
            else if(scope === 'queue') t = queueTickets[id];
            else if(scope === 'team') t = teamTickets[id];

            // UI Setup
            document.getElementById('empty-workspace').classList.add('hidden');
            document.getElementById('ticket-content-area').classList.remove('hidden');
            document.getElementById('divider-timer').classList.remove('hidden');
            document.getElementById('active-ticket-indicator').classList.remove('hidden');
            switchDetailTab('details'); // Reset tab

            // Fill Data
            document.getElementById('current-working-id').innerText = t.id;
            document.getElementById('detail-title').innerText = t.title;
            document.getElementById('detail-id').innerText = t.id;
            document.getElementById('detail-client').innerText = t.client;
            document.getElementById('detail-sla').innerText = t.sla;
            document.getElementById('detail-desc').innerText = t.desc;

            // Header Banner Logic
            const banner = document.getElementById('context-banner');
            const mainAction = document.getElementById('main-action-area');
            const statusSelect = document.getElementById('ticket-status');
            const saveBtn = document.getElementById('btn-save');
            const commentBox = document.getElementById('comment-box');

            if (scope === 'queue') {
                // MODO LEITURA (Preview)
                banner.className = "bg-yellow-100 text-yellow-800 px-4 py-2 text-xs font-bold text-center block";
                banner.innerText = "Modo de Leitura: Este chamado est√° na fila. Puxe para iniciar o atendimento.";
                
                statusSelect.disabled = true;
                saveBtn.disabled = true;
                commentBox.classList.add('hidden');
                document.getElementById('btn-start').disabled = true;

                // Bot√£o de A√ß√£o: Puxar
                mainAction.innerHTML = `
                    <button onclick="pullTicket(${id}, '${t.client}')" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold px-4 py-2 rounded shadow-sm flex items-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i> Puxar para Mim
                    </button>`;

            } else if (scope === 'team') {
                // MODO APOIO (Collaboration)
                banner.className = "bg-blue-100 text-blue-800 px-4 py-2 text-xs font-bold text-center block";
                banner.innerText = `Em atendimento por ${t.owner}. Voc√™ pode apoiar registrando atividades.`;
                
                statusSelect.disabled = true; // N√£o muda status do dono
                saveBtn.disabled = true;
                commentBox.classList.add('hidden'); // S√≥ comenta se iniciar apoio
                document.getElementById('btn-start').disabled = true;

                // Bot√£o de A√ß√£o: Apoiar
                mainAction.innerHTML = `
                    <button onclick="startSupport(${id})" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold px-4 py-2 rounded shadow-sm flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4"></i> Apoiar Atendimento
                    </button>`;

            } else {
                // MODO EDI√á√ÉO (Meus Casos)
                banner.className = "hidden";
                statusSelect.disabled = false;
                saveBtn.disabled = false;
                commentBox.classList.remove('hidden');
                
                // Bot√£o Padr√£o: Salvar
                mainAction.innerHTML = `
                    <div class="flex items-center gap-2">
                        <select id="ticket-status" class="bg-white border border-gray-300 text-gray-700 text-xs font-bold rounded p-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="open" ${t.status === 'open' ? 'selected' : ''}>Aberto</option>
                            <option value="progress" ${t.status === 'progress' ? 'selected' : ''}>Em Andamento</option>
                            <option value="pending" ${t.status === 'pending' ? 'selected' : ''}>Aguardando</option>
                            <option value="resolved" ${t.status === 'resolved' ? 'selected' : ''}>Resolvido</option>
                        </select>
                        <button onclick="saveTicketChanges()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold px-4 py-2 rounded shadow-sm flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i> Salvar
                        </button>
                    </div>`;
                
                if (!isRunning) document.getElementById('btn-start').disabled = false;
            }

            renderComments(t);
            lucide.createIcons();
        }

        // --- A√á√ïES ESPEC√çFICAS ---
        function pullTicket(id, clientName) {
            const hasConflict = Object.values(myTickets).some(ticket => ticket.client === clientName && ticket.status !== 'resolved');
            if (hasConflict) {
                showAlert(`Voc√™ j√° possui um chamado ativo para <strong>${clientName}</strong>. Finalize-o antes.`);
                return;
            }
            if(confirm(`Atribuir chamado ${id} para voc√™?`)) {
                const t = queueTickets[id];
                myTickets[id] = { ...t, status: 'progress', comments: [] };
                // Em app real, removeria da queue. Aqui simulamos troca de contexto.
                switchTab('my-tickets');
                loadTicket(id, 'my');
            }
        }

        function startSupport(id) {
            // Transformar ticket de Time em "Meu Caso" (Tempor√°rio/Apoio)
            if(confirm("Deseja iniciar sess√£o de apoio neste chamado?")) {
                const t = teamTickets[id];
                // Adiciona como 'my' mas mantendo flag de apoio
                myTickets[id] = { ...t, isSupport: true }; 
                switchTab('my-tickets');
                loadTicket(id, 'my');
                alert("Voc√™ entrou no modo de apoio. O tempo ser√° registrado em seu nome.");
            }
        }

        // --- DEMAIS FUN√á√ïES (Comments, Timer, Alerts) ---
        function renderComments(ticket) {
            const timeline = document.getElementById('comments-timeline');
            timeline.innerHTML = '';
            if (!ticket.comments || ticket.comments.length === 0) {
                timeline.innerHTML = `<div class="text-center text-xs text-gray-400 py-4 italic">Sem hist√≥rico.</div>`;
            } else {
                ticket.comments.forEach(c => {
                    timeline.innerHTML += `
                    <div class="flex gap-3 fade-in">
                        <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600 shrink-0">User</div>
                        <div class="bg-white border border-gray-200 p-3 rounded-lg w-full shadow-sm">
                            <p class="text-sm text-gray-600">${c.text}</p>
                            <span class="text-[10px] text-gray-400 block mt-1">${c.time || 'Recente'}</span>
                        </div>
                    </div>`;
                });
            }
        }

        function addComment() {
            const text = document.getElementById('new-comment-text').value;
            if (!text.trim()) return;
            const t = currentScope === 'my' ? myTickets[currentTicketId] : null;
            if (t) {
                t.comments.push({ text: text, time: 'Agora' });
                renderComments(t);
                document.getElementById('new-comment-text').value = '';
            }
        }

        // Timer (Simplificado)
        function startTimer() { isRunning = true; updateUI(true); timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000); }
        function pauseTimer() { isRunning = false; updateUI(false); clearInterval(timerInterval); }
        function stopTimer() { pauseTimer(); openLogModal(); }
        function updateUI(running) {
            document.getElementById('btn-start').classList.toggle('hidden', running);
            document.getElementById('btn-pause').classList.toggle('hidden', !running);
            document.getElementById('btn-stop').classList.toggle('hidden', !running);
            document.getElementById('timer-display').classList.toggle('text-red-500', running);
        }
        function updateTimerDisplay() {
            const h = Math.floor(seconds / 3600).toString().padStart(2,'0'), m = Math.floor((seconds%3600)/60).toString().padStart(2,'0'), s = (seconds%60).toString().padStart(2,'0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
        }
        
        // Modals
        function openLogModal() { 
            document.getElementById('modal-time').value = document.getElementById('timer-display').innerText;
            document.getElementById('log-summary').value = `Atendimento ${currentTicketId}`;
            document.getElementById('log-modal').classList.remove('hidden'); 
        }
        function closeLogModal() { document.getElementById('log-modal').classList.add('hidden'); }
        function confirmLog() { closeLogModal(); seconds = 0; updateTimerDisplay(); updateUI(false); alert("Salvo!"); }
        function saveTicketChanges() { alert("Salvo!"); }
        function showAlert(msg) { document.getElementById('alert-message').innerHTML = msg; document.getElementById('alert-modal').classList.remove('hidden'); }
        function closeAlert() { document.getElementById('alert-modal').classList.add('hidden'); }
        function updateAgentStatus(v) { 
            const led = document.getElementById('agent-status-led');
            led.className = `w-2 h-2 rounded-full ${v==='available'?'bg-green-500 animate-pulse':(v==='busy'?'bg-red-500':'bg-yellow-500')}`;
        }
    </script>
</body>
</html>