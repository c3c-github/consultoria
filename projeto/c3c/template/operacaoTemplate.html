<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Desk - C3C Workplace</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- √çcones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonte Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        c3c: {
                            blue: '#2978FF',
                            teal: '#1DDDBD',
                            dark: '#1a1a1a',
                            bg: '#F8FAFC'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #F8FAFC; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
        
        /* Anima√ß√£o do Cron√¥metro */
        .timer-pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Scrollbar fina */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="h-screen flex overflow-hidden bg-c3c-bg">

    <!-- 1. SIDEBAR -->
    <aside class="w-20 lg:w-64 bg-white border-r border-gray-100 flex flex-col z-20 transition-all duration-300">
        <div class="h-20 flex items-center justify-center lg:justify-start lg:px-8 border-b border-gray-50">
            <div class="w-8 h-8 bg-gradient-to-br from-[#2978FF] to-[#1DDDBD] rounded-lg flex items-center justify-center text-white font-bold text-xs">C3C</div>
            <span class="hidden lg:block ml-3 font-bold text-gray-800 tracking-wide text-lg">Workplace</span>
        </div>
        <nav class="flex-1 py-6 space-y-2">
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 text-gray-400 hover:bg-gray-50 transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="hidden lg:block font-medium text-sm">Vis√£o Geral</span>
            </a>
            <!-- Menu Ativo -->
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 bg-indigo-50 text-indigo-600 border-r-4 border-indigo-500 font-semibold transition-colors">
                <i data-lucide="headset" class="w-5 h-5"></i>
                <span class="hidden lg:block text-sm">Mesa de Opera√ß√µes</span>
            </a>
            <a href="#" class="flex items-center justify-center lg:justify-start gap-3 px-4 lg:px-6 py-3 text-gray-400 hover:bg-gray-50 transition-colors">
                <i data-lucide="clock" class="w-5 h-5"></i>
                <span class="hidden lg:block font-medium text-sm">Minhas Horas</span>
            </a>
        </nav>
        
        <!-- Widget Status do Agente -->
        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-gray-500 uppercase">Meu Status</span>
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse" id="agent-status-led"></span>
            </div>
            <select id="agent-status-select" onchange="updateAgentStatus(this.value)" class="w-full text-xs border-gray-300 rounded p-1 bg-white text-gray-700 font-bold focus:ring-0 cursor-pointer">
                <option value="available">üü¢ Dispon√≠vel</option>
                <option value="busy">üî¥ Em Atendimento</option>
                <option value="break">‚òï Pausa</option>
            </select>
        </div>
    </aside>

    <!-- 2. MAIN CONTENT -->
    <main class="flex-1 flex flex-col relative w-full overflow-hidden">
        
        <!-- Header: Filas e Aloca√ß√£o -->
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shrink-0 shadow-sm z-10">
            <div class="flex items-center gap-4">
                <h1 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i data-lucide="layers" class="w-5 h-5 text-indigo-600"></i>
                    Gest√£o de Chamados
                </h1>
                <div class="h-6 w-px bg-gray-200"></div>
                
                <!-- Pills de Aloca√ß√£o -->
                <div class="flex gap-2">
                    <div class="flex items-center gap-2 px-3 py-1 bg-blue-50 border border-blue-100 rounded-full">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="text-xs font-bold text-blue-700">Squad Salesforce (N2)</span>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-1 bg-purple-50 border border-purple-100 rounded-full">
                        <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                        <span class="text-xs font-bold text-purple-700">Infraestrutura Geral</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-right">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">Produtividade Hoje</p>
                    <p class="text-sm font-bold text-gray-800">4h 15m (3 tickets)</p>
                </div>
            </div>
        </header>

        <!-- Content Area: Split View -->
        <div class="flex-1 flex overflow-hidden">
            
            <!-- COLUNA ESQUERDA: LISTAS (40%) -->
            <div class="w-[450px] flex flex-col border-r border-gray-200 bg-white">
                
                <!-- Abas de Navega√ß√£o -->
                <div class="flex border-b border-gray-200">
                    <button onclick="switchTab('my-tickets')" id="tab-my-tickets" class="flex-1 py-3 text-sm font-bold text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50 hover:bg-indigo-50 transition-colors">
                        Meus Casos (<span id="count-my">2</span>)
                    </button>
                    <button onclick="switchTab('queue')" id="tab-queue" class="flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:bg-gray-50 transition-colors">
                        Fila Geral (<span id="count-queue">5</span>)
                    </button>
                </div>

                <!-- Filtros R√°pidos -->
                <div class="p-3 border-b border-gray-100 flex gap-2 bg-white">
                    <input type="text" placeholder="Buscar ID ou Cliente..." class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button class="p-1.5 bg-gray-100 rounded-lg hover:bg-gray-200"><i data-lucide="filter" class="w-4 h-4 text-gray-600"></i></button>
                </div>

                <!-- Lista: MEUS CASOS -->
                <div id="list-my-tickets" class="flex-1 overflow-y-auto p-3 space-y-2 bg-gray-50/50">
                    <!-- Ticket Ativo (Exemplo) -->
                    <div onclick="loadTicket(1)" class="ticket-card cursor-pointer bg-white border border-l-4 border-l-green-500 border-gray-200 rounded-lg p-3 hover:shadow-md transition-all relative">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-600">#4505</span>
                            <span class="text-[10px] font-bold text-green-600 bg-green-50 px-2 rounded">Em Andamento</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Cria√ß√£o de Usu√°rio Salesforce</h4>
                        <div class="flex justify-between items-end">
                            <span class="text-[10px] text-gray-500 bg-gray-100 px-1.5 rounded">Tech Solutions</span>
                            <span class="text-[10px] text-gray-400">SLA: 4h</span>
                        </div>
                    </div>

                    <!-- Ticket Pendente (Exemplo) -->
                    <div onclick="loadTicket(3)" class="ticket-card cursor-pointer bg-white border border-l-4 border-l-yellow-400 border-gray-200 rounded-lg p-3 hover:shadow-md transition-all opacity-80">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-600">#4498</span>
                            <span class="text-[10px] font-bold text-yellow-600 bg-yellow-50 px-2 rounded">Aguardando Cliente</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">D√∫vida Relat√≥rio Leads</h4>
                        <div class="flex justify-between items-end">
                            <span class="text-[10px] text-gray-500 bg-gray-100 px-1.5 rounded">Banco Alpha</span>
                            <span class="text-[10px] text-gray-400">SLA: 2d</span>
                        </div>
                    </div>
                </div>

                <!-- Lista: FILA GERAL (Oculta por padr√£o) -->
                <div id="list-queue" class="hidden flex-1 overflow-y-auto p-3 space-y-2 bg-gray-50/50">
                    <!-- Ticket Cr√≠tico na Fila -->
                    <div class="bg-white border border-l-4 border-l-red-500 border-gray-200 rounded-lg p-3 shadow-sm group">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-red-600">#4502 (Cr√≠tico)</span>
                            <span class="text-[10px] font-bold text-red-500 flex items-center gap-1"><i data-lucide="alert-circle" class="w-3 h-3"></i> SLA Vencido</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Erro 500 Checkout VTEX</h4>
                        <p class="text-xs text-gray-500 mb-2">Varejo Express</p>
                        <button onclick="pullTicket(4502, 'Varejo Express')" class="w-full py-1.5 bg-indigo-50 text-indigo-700 text-xs font-bold rounded hover:bg-indigo-100 transition-colors flex items-center justify-center gap-1">
                            <i data-lucide="download" class="w-3 h-3"></i> Puxar Chamado
                        </button>
                    </div>

                    <!-- Ticket Normal na Fila -->
                    <div class="bg-white border border-l-4 border-l-gray-300 border-gray-200 rounded-lg p-3 shadow-sm group">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs font-mono font-bold text-gray-500">#4510</span>
                            <span class="text-[10px] font-bold text-gray-400">N√≠vel 1</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm mb-1">Reset de Senha AD</h4>
                        <p class="text-xs text-gray-500 mb-2">Tech Solutions</p>
                        <button onclick="pullTicket(4510, 'Tech Solutions')" class="w-full py-1.5 bg-gray-100 text-gray-600 text-xs font-bold rounded hover:bg-gray-200 transition-colors flex items-center justify-center gap-1">
                            <i data-lucide="download" class="w-3 h-3"></i> Puxar Chamado
                        </button>
                    </div>
                </div>
            </div>

            <!-- COLUNA DIREITA: DETALHE & WORKFLOW (60%) -->
            <div class="flex-1 bg-gray-50 flex flex-col relative" id="ticket-workspace">
                
                <!-- Barra de Ferramentas / Cron√¥metro (Fixo no Topo) -->
                <div class="bg-white border-b border-gray-200 p-4 shadow-sm z-20 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div id="active-ticket-indicator" class="hidden flex flex-col">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Trabalhando em:</span>
                            <span class="text-sm font-bold text-indigo-600" id="current-working-id">#4505</span>
                        </div>
                        <div class="h-8 w-px bg-gray-200 hidden" id="divider-timer"></div>
                        <!-- Cron√¥metro -->
                        <div class="flex items-center gap-2">
                            <div class="text-3xl font-mono font-bold text-gray-800 tracking-wider" id="timer-display">00:00:00</div>
                            <div class="flex gap-1">
                                <button id="btn-start" onclick="startTimer()" class="p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg shadow-sm transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                                </button>
                                <button id="btn-pause" onclick="pauseTimer()" class="hidden p-2 bg-yellow-400 hover:bg-yellow-500 text-white rounded-lg shadow-sm transition-transform active:scale-95">
                                    <i data-lucide="pause" class="w-5 h-5 fill-current"></i>
                                </button>
                                <button id="btn-stop" onclick="stopTimer()" class="hidden p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-sm transition-transform active:scale-95">
                                    <i data-lucide="square" class="w-5 h-5 fill-current"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- A√ß√µes de Workflow -->
                    <div class="flex items-center gap-2">
                        <select id="ticket-status" class="bg-white border border-gray-300 text-gray-700 text-xs font-bold rounded p-2 focus:ring-indigo-500 focus:border-indigo-500" disabled>
                            <option value="open">Aberto</option>
                            <option value="progress">Em Andamento</option>
                            <option value="pending">Aguardando Cliente</option>
                            <option value="resolved">Resolvido</option>
                        </select>
                        <button onclick="saveTicketChanges()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold px-4 py-2 rounded shadow-sm flex items-center gap-2 disabled:opacity-50" id="btn-save" disabled>
                            <i data-lucide="save" class="w-4 h-4"></i> Salvar
                        </button>
                    </div>
                </div>

                <!-- Conte√∫do do Ticket (Abas) -->
                <div id="ticket-content-area" class="flex-1 overflow-y-auto p-6 hidden">
                    
                    <!-- Cabe√ßalho do Ticket -->
                    <div class="mb-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 leading-tight mb-2" id="detail-title">Titulo do Ticket</h1>
                                <div class="flex items-center gap-3 text-sm">
                                    <span class="bg-gray-200 text-gray-700 px-2 py-0.5 rounded font-mono font-bold" id="detail-id">#ID</span>
                                    <span class="flex items-center gap-1 text-gray-500"><i data-lucide="briefcase" class="w-3 h-3"></i> <span id="detail-client">Cliente</span></span>
                                    <span class="flex items-center gap-1 text-red-500 font-bold"><i data-lucide="clock" class="w-3 h-3"></i> <span id="detail-sla">SLA</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Abas Internas -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[400px] flex flex-col">
                        <div class="flex border-b border-gray-200 bg-gray-50">
                            <button class="px-6 py-3 text-sm font-bold text-gray-700 bg-white border-t-2 border-indigo-500">Detalhes & Hist√≥rico</button>
                            <button class="px-6 py-3 text-sm font-bold text-gray-500 hover:text-indigo-600 hover:bg-white transition-colors">Anexos (2)</button>
                            <button class="px-6 py-3 text-sm font-bold text-gray-500 hover:text-indigo-600 hover:bg-white transition-colors">SLA & Metadados</button>
                        </div>

                        <div class="p-6 flex-1 flex flex-col">
                            <!-- Descri√ß√£o -->
                            <div class="bg-blue-50/50 p-4 rounded-lg border border-blue-100 mb-6">
                                <p class="text-xs font-bold text-blue-800 uppercase mb-2">Descri√ß√£o do Incidente</p>
                                <p class="text-sm text-gray-700 leading-relaxed" id="detail-desc">
                                    Descri√ß√£o completa aqui...
                                </p>
                            </div>

                            <!-- Timeline de Coment√°rios -->
                            <div class="flex-1 overflow-y-auto space-y-4 mb-4 pr-2 max-h-[300px]" id="comments-timeline">
                                <!-- Coment√°rio Mock -->
                                <div class="flex gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600 shrink-0">N1</div>
                                    <div class="bg-gray-100 p-3 rounded-lg rounded-tl-none w-full">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-xs font-bold text-gray-700">Analista N1</span>
                                            <span class="text-[10px] text-gray-400">Ontem 14:30</span>
                                        </div>
                                        <p class="text-sm text-gray-600">Escalando para N2 pois requer acesso ao banco de dados.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Input de Novo Coment√°rio -->
                            <div class="mt-auto pt-4 border-t border-gray-100">
                                <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Adicionar Atualiza√ß√£o</label>
                                <div class="flex gap-2">
                                    <textarea id="new-comment-text" class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none resize-none h-20" placeholder="Descreva o que foi feito ou solicite informa√ß√µes..."></textarea>
                                    <button onclick="addComment()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 rounded-lg shadow-sm font-bold transition-colors">
                                        <i data-lucide="send" class="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div class="flex gap-4 mt-2">
                                    <label class="flex items-center gap-2 text-xs text-gray-600 cursor-pointer">
                                        <input type="checkbox" class="rounded text-indigo-600 focus:ring-indigo-500"> Notificar Cliente
                                    </label>
                                    <label class="flex items-center gap-2 text-xs text-gray-600 cursor-pointer">
                                        <input type="checkbox" class="rounded text-indigo-600 focus:ring-indigo-500" checked> Vis√≠vel Apenas Internamente
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State (Direita) -->
                <div id="empty-workspace" class="flex-1 flex flex-col items-center justify-center text-gray-400 text-center opacity-60">
                    <i data-lucide="monitor" class="w-16 h-16 mb-4 text-gray-300"></i>
                    <h3 class="text-lg font-bold text-gray-500">Nenhum chamado selecionado</h3>
                    <p class="text-sm">Selecione um chamado da lista para come√ßar a trabalhar.</p>
                </div>

            </div>
        </div>
    </main>

    <!-- Modal de Registro de Tempo (Stop) -->
    <div id="log-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-xl">
                <h3 class="font-bold text-indigo-900 flex items-center gap-2">
                    <i data-lucide="check-circle" class="w-4 h-4"></i> Finalizar Sess√£o de Trabalho
                </h3>
            </div>
            <div class="p-6">
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 font-bold mb-1">Tempo Total</label>
                        <input type="text" id="modal-time" class="w-full border border-gray-300 rounded p-2 font-mono font-bold text-lg text-center bg-gray-50" readonly>
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 font-bold mb-1">Classifica√ß√£o</label>
                        <select class="w-full border border-gray-300 rounded p-2 text-sm bg-white">
                            <option>Atendimento N2</option>
                            <option>Investiga√ß√£o</option>
                            <option>Reuni√£o</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-xs text-gray-500 font-bold mb-1">Resumo para Folha de Ponto</label>
                    <input type="text" class="w-full border border-gray-300 rounded p-2 text-sm" value="Atendimento t√©cnico ticket #..." id="log-summary">
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="closeLogModal()" class="px-4 py-2 text-gray-500 font-bold text-xs hover:bg-gray-100 rounded">Cancelar</button>
                    <button onclick="confirmLog()" class="px-4 py-2 bg-indigo-600 text-white font-bold text-xs rounded hover:bg-indigo-700 shadow-md">Salvar na Folha</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerta de Bloqueio (Concorr√™ncia) -->
    <div id="alert-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm transform scale-95 transition-transform duration-300 border-l-4 border-red-500">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-3 text-red-600">
                    <i data-lucide="alert-octagon" class="w-8 h-8"></i>
                    <h3 class="text-lg font-bold">A√ß√£o Bloqueada</h3>
                </div>
                <p class="text-sm text-gray-600 mb-4" id="alert-message">
                    Voc√™ j√° possui um chamado em aberto para este cliente. Finalize ou pause o atual antes de iniciar outro.
                </p>
                <div class="flex justify-end">
                    <button onclick="closeAlert()" class="px-4 py-2 bg-gray-100 text-gray-700 font-bold text-sm rounded hover:bg-gray-200">Entendido</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // --- DADOS (Mock) ---
        // Tickets do Usu√°rio (Meus Casos)
        const myTickets = {
            1: { id: '#4505', title: 'Cria√ß√£o de Usu√°rio Salesforce', client: 'Tech Solutions', sla: '4h', desc: 'Novo colaborador no setor comercial. Perfil: Sales Rep.', status: 'progress', comments: [] },
            3: { id: '#4498', title: 'D√∫vida Relat√≥rio Leads', client: 'Banco Alpha', sla: '2d', desc: 'Usu√°rio com d√∫vida sobre os filtros do relat√≥rio mensal.', status: 'pending', comments: [] }
        };

        // Fila Geral (Backlog)
        const queueTickets = {
            4502: { id: '#4502', title: 'Erro 500 Checkout VTEX', client: 'Varejo Express', sla: 'Vencido', desc: 'Cr√≠tico: Loja parada.', status: 'open' },
            4510: { id: '#4510', title: 'Reset de Senha AD', client: 'Tech Solutions', sla: '8h', desc: 'Usu√°rio bloqueado.', status: 'open' }
        };

        let currentTicketId = null;
        let timerInterval = null;
        let seconds = 0;
        let isRunning = false;

        // --- NAVEGA√á√ÉO DE ABAS (LISTA) ---
        function switchTab(tab) {
            const btnMy = document.getElementById('tab-my-tickets');
            const btnQueue = document.getElementById('tab-queue');
            const listMy = document.getElementById('list-my-tickets');
            const listQueue = document.getElementById('list-queue');

            if (tab === 'my-tickets') {
                btnMy.className = "flex-1 py-3 text-sm font-bold text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50 transition-colors";
                btnQueue.className = "flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:bg-gray-50 transition-colors";
                listMy.classList.remove('hidden');
                listQueue.classList.add('hidden');
            } else {
                btnQueue.className = "flex-1 py-3 text-sm font-bold text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50 transition-colors";
                btnMy.className = "flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:bg-gray-50 transition-colors";
                listQueue.classList.remove('hidden');
                listMy.classList.add('hidden');
            }
        }

        // --- CARREGAR TICKET (MEUS CASOS) ---
        function loadTicket(id) {
            const t = myTickets[id];
            currentTicketId = id;

            // UI Changes
            document.getElementById('empty-workspace').classList.add('hidden');
            document.getElementById('ticket-content-area').classList.remove('hidden');
            document.getElementById('active-ticket-indicator').classList.remove('hidden');
            document.getElementById('divider-timer').classList.remove('hidden');
            
            // Populate Header
            document.getElementById('current-working-id').innerText = t.id;
            document.getElementById('detail-title').innerText = t.title;
            document.getElementById('detail-id').innerText = t.id;
            document.getElementById('detail-client').innerText = t.client;
            document.getElementById('detail-sla').innerText = t.sla;
            document.getElementById('detail-desc').innerText = t.desc;
            
            // Populate Status
            const statusSelect = document.getElementById('ticket-status');
            statusSelect.value = t.status;
            statusSelect.disabled = false;
            document.getElementById('btn-save').disabled = false;

            // Enable Timer Start if not running
            if (!isRunning) {
                document.getElementById('btn-start').disabled = false;
            } else {
                // Se j√° estiver rodando, mantemos o timer rodando, mas mudamos o contexto visual?
                // Regra: Timer √© global. Se mudar de ticket, o timer continua contando para o anterior at√© parar?
                // Simplifica√ß√£o: Timer pausa ao mudar de contexto ou avisa.
                // Neste prot√≥tipo, assumimos que o timer √© do "Ticket Ativo no Workspace".
            }

            renderComments(t);
        }

        // --- REGRA DE NEG√ìCIO: PUXAR CHAMADO (COM VALIDA√á√ÉO) ---
        function pullTicket(id, clientName) {
            // 1. Verificar Concorr√™ncia
            // Procurar nos "Meus Tickets" se j√° existe algo desse cliente com status != resolved
            const hasConflict = Object.values(myTickets).some(ticket => 
                ticket.client === clientName && ticket.status !== 'resolved'
            );

            if (hasConflict) {
                showAlert(`Voc√™ j√° possui um chamado ativo para <strong>${clientName}</strong> em "Meus Casos".<br>Finalize-o ou coloque em espera antes de puxar outro.`);
                return;
            }

            // 2. Sucesso: Mover para Meus Casos (Simulado)
            if(confirm(`Confirmar atribui√ß√£o do chamado ${id} para sua fila?`)) {
                // Mock da movimenta√ß√£o
                const t = queueTickets[id];
                // Adiciona aos meus
                myTickets[id] = { ...t, status: 'progress', comments: [] }; // Assume progresso ao puxar
                // Remove da fila (Visualmente apenas recarregaria, aqui vamos simular um reload)
                alert(`Chamado ${id} atribu√≠do a voc√™ com sucesso!`);
                switchTab('my-tickets');
                loadTicket(id);
            }
        }

        // --- SISTEMA DE COMENT√ÅRIOS ---
        function renderComments(ticket) {
            const timeline = document.getElementById('comments-timeline');
            timeline.innerHTML = '';
            
            // Mock de hist√≥rico inicial se vazio
            if (!ticket.comments || ticket.comments.length === 0) {
                timeline.innerHTML = `
                    <div class="text-center text-xs text-gray-400 py-4 italic">In√≠cio do atendimento.</div>
                `;
            } else {
                ticket.comments.forEach(c => {
                    timeline.innerHTML += `
                    <div class="flex gap-3 fade-in">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-xs font-bold text-indigo-600 shrink-0">EU</div>
                        <div class="bg-white border border-gray-200 p-3 rounded-lg w-full shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs font-bold text-gray-700">Voc√™</span>
                                <span class="text-[10px] text-gray-400">Agora</span>
                            </div>
                            <p class="text-sm text-gray-600">${c.text}</p>
                        </div>
                    </div>`;
                });
            }
        }

        function addComment() {
            const text = document.getElementById('new-comment-text').value;
            if (!text.trim()) return;
            
            if (currentTicketId && myTickets[currentTicketId]) {
                myTickets[currentTicketId].comments.push({ text: text, time: new Date() });
                renderComments(myTickets[currentTicketId]);
                document.getElementById('new-comment-text').value = '';
                // Auto scroll
                const timeline = document.getElementById('comments-timeline');
                timeline.scrollTop = timeline.scrollHeight;
            }
        }

        function saveTicketChanges() {
            const status = document.getElementById('ticket-status').value;
            if (currentTicketId && myTickets[currentTicketId]) {
                myTickets[currentTicketId].status = status;
                alert("Altera√ß√µes salvas com sucesso.");
                // O ideal seria atualizar a lista visualmente tamb√©m (badges)
            }
        }

        // --- UTILIT√ÅRIOS VISUAIS ---
        function updateAgentStatus(status) {
            const led = document.getElementById('agent-status-led');
            if (status === 'available') led.className = "w-2 h-2 bg-green-500 rounded-full animate-pulse";
            if (status === 'busy') led.className = "w-2 h-2 bg-red-500 rounded-full";
            if (status === 'break') led.className = "w-2 h-2 bg-yellow-500 rounded-full";
        }

        function showAlert(msg) {
            document.getElementById('alert-message').innerHTML = msg;
            const modal = document.getElementById('alert-modal');
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); modal.querySelector('div').classList.remove('scale-95'); }, 10);
        }

        function closeAlert() {
            const modal = document.getElementById('alert-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        // --- TIMER LOGIC (Mantida do anterior) ---
        function updateTimerDisplay() {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
        }

        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            document.getElementById('btn-start').classList.add('hidden');
            document.getElementById('btn-pause').classList.remove('hidden');
            document.getElementById('btn-stop').classList.remove('hidden');
            document.getElementById('timer-display').classList.add('text-red-500', 'timer-pulse');
            document.getElementById('timer-display').classList.remove('text-gray-800');
            updateAgentStatus('busy'); // Auto-set status
            document.getElementById('agent-status-select').value = 'busy';

            timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('btn-start').classList.remove('hidden');
            document.getElementById('btn-pause').classList.add('hidden');
            document.getElementById('timer-display').classList.remove('timer-pulse');
        }

        function stopTimer() {
            pauseTimer();
            const t = myTickets[currentTicketId];
            document.getElementById('modal-time').value = document.getElementById('timer-display').innerText;
            document.getElementById('log-summary').value = `Atendimento ticket ${t.id}`;
            
            const modal = document.getElementById('log-modal');
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); modal.querySelector('div').classList.remove('scale-95'); }, 10);
        }

        function confirmLog() {
            closeLogModal();
            seconds = 0;
            updateTimerDisplay();
            document.getElementById('timer-display').classList.add('text-gray-800');
            document.getElementById('timer-display').classList.remove('text-red-500');
            document.getElementById('btn-stop').classList.add('hidden');
            updateAgentStatus('available');
            document.getElementById('agent-status-select').value = 'available';
            alert("Tempo registrado na folha!");
        }

        function closeLogModal() {
            const modal = document.getElementById('log-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }
    </script>
</body>
</html>