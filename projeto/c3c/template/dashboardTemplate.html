<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - C3C Workplace</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- √çcones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonte Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js para Gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        c3c: {
                            blue: '#2978FF',
                            teal: '#1DDDBD',
                            gray: '#F2F2F2',
                            dark: '#1a1a1a'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #F8FAFC; }
        
        /* Gradiente C3C */
        .bg-c3c-gradient {
            background: linear-gradient(135deg, #2978FF 0%, #1DDDBD 100%);
        }
        
        .text-c3c-gradient {
            background: linear-gradient(135deg, #2978FF 0%, #1DDDBD 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Scrollbar customizada */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .nav-item.active {
            background-color: #EEF2FF;
            color: #2978FF;
            border-right: 3px solid #2978FF;
        }

        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Utilit√°rio para Modais Empilhados */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- 1. SIDEBAR -->
    <aside class="w-64 bg-white border-r border-gray-100 flex flex-col hidden md:flex shadow-sm z-20">
        <!-- Logo Area -->
        <div class="h-20 flex items-center px-8 border-b border-gray-50">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-c3c-gradient rounded-lg flex items-center justify-center text-white font-bold text-xs">C3C</div>
                <span class="font-bold text-gray-800 tracking-wide text-lg">Workplace</span>
            </div>
        </div>

        <!-- Menu Navigation -->
        <nav class="flex-1 py-6 space-y-1">
            <p class="px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Principal</p>
            
            <a href="#" onclick="navigate('home')" id="nav-home" class="nav-item active flex items-center gap-3 px-6 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="font-medium text-sm">Vis√£o Geral</span>
            </a>

            <p class="px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-8 mb-2">Servi√ßos</p>

            <a href="#" onclick="navigate('approval')" id="nav-approval" class="nav-item flex items-center gap-3 px-6 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors">
                <i data-lucide="clock" class="w-5 h-5"></i>
                <span class="font-medium text-sm">Aprova√ß√£o de Horas</span>
                <span class="ml-auto bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full">3</span>
            </a>
        </nav>

        <!-- User Profile (Bottom) -->
        <div class="p-4 border-t border-gray-50">
            <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                <!-- Fallback to initials if image fails or generic icon -->
                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold border border-gray-300">FS</div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-gray-900 truncate">Felix Silva</p>
                    <p class="text-xs text-gray-500 truncate">Gerente de Projetos</p>
                </div>
                <i data-lucide="log-out" class="w-4 h-4 text-gray-400"></i>
            </div>
        </div>
    </aside>

    <!-- 2. MAIN CONTENT AREA -->
    <main class="flex-1 flex flex-col bg-[#F8FAFC] overflow-hidden relative">
        
        <!-- Mobile Header -->
        <div class="md:hidden h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4">
            <span class="font-bold text-gray-800">C3C Workplace</span>
            <button class="p-2"><i data-lucide="menu" class="w-6 h-6 text-gray-600"></i></button>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8" id="content-area">
            
            <!-- VIEW: HOME (DASHBOARD) -->
            <div id="view-home" class="fade-in">
                <header class="mb-8">
                    <h1 class="text-2xl font-bold text-gray-900">Bom dia, Felix! üëã</h1>
                    <p class="text-gray-500 text-sm mt-1">Aqui est√° o resumo dos seus servi√ßos hoje.</p>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Stat Card 1 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group">
                        <div class="absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div class="relative z-10">
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-2">Horas Pendentes</p>
                            <div class="flex items-end gap-2">
                                <span class="text-3xl font-bold text-gray-900">124h</span>
                                <!-- Ajuste: Removida a setinha, mantido apenas o texto -->
                                <span class="text-xs text-red-500 font-bold mb-1">
                                    Necessita Aprova√ß√£o
                                </span>
                            </div>
                        </div>
                    </div>
                    <!-- Stat Card 2 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group">
                        <div class="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div class="relative z-10">
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-2">Efici√™ncia da Equipe</p>
                            <div class="flex items-end gap-2">
                                <span class="text-3xl font-bold text-gray-900">94%</span>
                                <span class="text-xs text-gray-400 font-medium mb-1">Fatur√°vel / Total</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-[#2978FF] to-[#1DDDBD] rounded-2xl p-8 text-white flex items-center justify-between shadow-lg">
                    <div>
                        <h3 class="text-xl font-bold mb-2">Aprova√ß√µes Pendentes</h3>
                        <p class="text-blue-50 text-sm max-w-md">Voc√™ tem per√≠odos em aberto que impedem o faturamento. Revise as horas lan√ßadas pela equipe.</p>
                        <button onclick="navigate('approval')" class="mt-6 bg-white text-blue-600 text-sm font-bold px-5 py-2.5 rounded-lg hover:bg-blue-50 transition-colors shadow-md">
                            Ir para Aprova√ß√µes
                        </button>
                    </div>
                    <div class="hidden md:block opacity-90">
                        <i data-lucide="clock" class="w-24 h-24 text-white opacity-50"></i>
                    </div>
                </div>
            </div>

            <!-- VIEW: APROVA√á√ÉO DE HORAS -->
            <div id="view-approval" class="hidden fade-in">
                <header class="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                            Aprova√ß√£o de Horas
                            <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full">Gestor</span>
                        </h1>
                        <p class="text-gray-500 text-sm mt-1">Analise os lan√ßamentos por Servi√ßo e Conformidade do Recurso.</p>
                    </div>
                    
                    <!-- Seletor de Per√≠odo -->
                    <div class="flex items-center bg-white rounded-lg shadow-sm border border-gray-200 p-1">
                        <span class="px-3 text-xs font-bold text-gray-400 uppercase">Per√≠odo:</span>
                        <select id="period-selector" class="text-sm font-semibold text-gray-800 bg-transparent outline-none cursor-pointer py-1 pr-2" onchange="filterApprovals()">
                            <option value="open">Dezembro/2024 (Em Aberto)</option>
                            <option value="closing">Novembro/2024 (Fechamento)</option>
                        </select>
                    </div>
                </header>

                <!-- Grid de Servi√ßos para Aprova√ß√£o -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="approval-cards-container">
                    <!-- Os cards ser√£o injetados via JS -->
                </div>
            </div>

        </div>
    </main>

    <!-- Modal 1: Detalhes do Servi√ßo (N√≠vel 1) -->
    <div id="details-modal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-4 transform scale-95 transition-transform duration-300 flex flex-col max-h-[90vh]">
            
            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50 rounded-t-xl">
                <div>
                    <h3 class="text-xl font-bold text-gray-900" id="modal-title">Detalhes do Servi√ßo</h3>
                    <p class="text-gray-500 text-sm">An√°lise de conformidade e aprova√ß√£o por recurso.</p>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-2"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>

            <!-- Modal Body (Scrollable) -->
            <div class="p-6 overflow-y-auto flex-1">
                <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-6 flex items-start gap-3">
                    <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                    <div class="text-sm text-blue-800">
                        <span class="font-bold">Dica de Gest√£o:</span> Verifique se o total de horas do recurso excede o contrato individual, mesmo se o projeto tiver saldo.
                    </div>
                </div>

                <!-- Tabela de Recursos -->
                <div class="overflow-hidden rounded-lg border border-gray-200">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-wider">
                            <tr>
                                <th class="px-6 py-4">Recurso</th>
                                <th class="px-6 py-4">Total Horas</th>
                                <th class="px-6 py-4">Horas Extras</th>
                                <th class="px-6 py-4">Conformidade</th>
                                <th class="px-6 py-4 text-right">A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100" id="modal-resources-body">
                            <!-- Injetado via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-100 flex justify-end gap-3 bg-gray-50 rounded-b-xl">
                <button onclick="closeModal()" class="px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium shadow-sm">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal 2: Extrato de Lan√ßamentos do Recurso (N√≠vel 2 - Drill Down) -->
    <div id="resource-logs-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl mx-4 transform scale-95 transition-transform duration-300 flex flex-col max-h-[90vh]">
            
            <!-- Header do Recurso -->
            <div class="p-6 bg-gray-900 text-white rounded-t-xl flex justify-between items-start">
                <div>
                    <h3 class="text-xl font-bold" id="rl-resource-name">Nome do Recurso</h3>
                    <p class="text-gray-400 text-xs mt-1 uppercase tracking-wider">Extrato de Lan√ßamentos - <span id="rl-period">Dezembro/2024</span></p>
                    
                    <div class="flex gap-6 mt-4">
                        <div>
                            <span class="block text-2xl font-bold text-[#1DDDBD]" id="rl-total-hours">0h</span>
                            <span class="text-xs text-gray-400">Total Apontado</span>
                        </div>
                        <div>
                            <span class="block text-2xl font-bold text-gray-200" id="rl-contract-hours">168h</span>
                            <span class="text-xs text-gray-400">Jornada Contratada</span>
                        </div>
                         <div>
                            <span class="block text-2xl font-bold text-red-400" id="rl-overtime-hours">0h</span>
                            <span class="text-xs text-gray-400">Horas Extras</span>
                        </div>
                    </div>
                </div>
                <button onclick="closeResourceLogs()" class="bg-gray-800 hover:bg-gray-700 p-2 rounded-lg text-gray-300 transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Body: Timeline de Lan√ßamentos -->
            <div class="p-0 overflow-y-auto flex-1 bg-gray-50">
                <!-- Tabela de Dias -->
                <table class="w-full text-sm text-left border-collapse">
                    <thead class="bg-white text-gray-500 uppercase text-xs font-bold sticky top-0 shadow-sm">
                        <tr>
                            <th class="px-6 py-4 border-b border-gray-100 w-32">Dia</th>
                            <th class="px-6 py-4 border-b border-gray-100">Aloca√ß√£o / Atividade</th>
                            <th class="px-6 py-4 border-b border-gray-100 text-center">Jornada (8h)</th>
                            <th class="px-6 py-4 border-b border-gray-100 text-right">Lan√ßado</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100 bg-white" id="rl-logs-body">
                        <!-- JS vai preencher -->
                    </tbody>
                </table>
            </div>

             <div class="p-4 border-t border-gray-100 bg-white rounded-b-xl flex justify-between items-center text-xs text-gray-500">
                <span>* HE: Hora Extra (Acima de 8h/dia)</span>
                <button onclick="closeResourceLogs()" class="px-4 py-2 bg-gray-100 text-gray-700 font-bold rounded hover:bg-gray-200">Voltar para Resumo</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Inicializar √≠cones
        lucide.createIcons();

        // --- MOCK DATA (Simulando API REST) ---
        
        const approvalData = [
            {
                serviceId: 101,
                serviceName: "Consultoria Salesforce CRM",
                client: "Tech Solutions Ltda",
                regularHours: 120.5,
                overtimeHours: 12.0,
                status: "Pendente",
                teamSize: 3
            },
            {
                serviceId: 102,
                serviceName: "Desenvolvimento Power BI",
                client: "Grupo Financeiro Alpha",
                regularHours: 40.0,
                overtimeHours: 0.0,
                status: "Pendente",
                teamSize: 1
            },
            {
                serviceId: 103,
                serviceName: "Suporte N2 - Infraestrutura",
                client: "Varejo Express",
                regularHours: 160.0,
                overtimeHours: 4.5,
                status: "Em An√°lise",
                teamSize: 2
            }
        ];

        // Detalhes "Deep Dive" por Recurso - Adicionado estado 'status_approval' e 'logs_viewed'
        // status_approval: null, 'approved', 'rejected'
        const serviceDetails = {
            101: [
                { name: "Jo√£o Silva", total: 40.0, overtime: 0.0, limit: 160, status: "ok", status_approval: null, logs_viewed: false },
                { name: "Maria Costa", total: 65.5, overtime: 12.0, limit: 160, status: "warning", status_approval: null, logs_viewed: false },
                { name: "Carlos Souza", total: 15.0, overtime: 0.0, limit: 160, status: "ok", status_approval: null, logs_viewed: false }
            ],
            102: [
                { name: "Ana Lima", total: 40.0, overtime: 0.0, limit: 160, status: "ok", status_approval: null, logs_viewed: false }
            ],
            103: [
                { name: "Roberto Dias", total: 170.0, overtime: 10.0, limit: 160, status: "danger", status_approval: null, logs_viewed: false },
                { name: "Fernanda K.", total: 4.5, overtime: 0.0, limit: 160, status: "ok", status_approval: null, logs_viewed: false }
            ]
        };

        const resourceLogsData = {
            "Maria Costa": [
                { date: "02/12", wday: "Seg", project: "Consultoria Salesforce", desc: "Reuni√£o Kickoff e Setup", hours: 9.0, type: "extra" },
                { date: "03/12", wday: "Ter", project: "Consultoria Salesforce", desc: "Configura√ß√£o de Ambientes", hours: 8.0, type: "normal" },
                { date: "04/12", wday: "Qua", project: "Consultoria Salesforce", desc: "Treinamento Key Users", hours: 10.0, type: "extra" },
                { date: "05/12", wday: "Qui", project: "Consultoria Salesforce", desc: "Documenta√ß√£o T√©cnica", hours: 8.0, type: "normal" },
                { date: "06/12", wday: "Sex", project: "Consultoria Salesforce", desc: "Deploy e Testes", hours: 8.5, type: "extra" },
                { date: "09/12", wday: "Seg", project: "Consultoria Salesforce", desc: "Suporte P√≥s-GoLive", hours: 11.0, type: "extra" },
                { date: "10/12", wday: "Ter", project: "Interno", desc: "Aus√™ncia Justificada", hours: 4.0, type: "under" },
            ],
            "Roberto Dias": [
                { date: "02/12", wday: "Seg", project: "Suporte N2", desc: "Monitoramento", hours: 8.0, type: "normal" },
                { date: "03/12", wday: "Ter", project: "Suporte N2", desc: "Chamado Cr√≠tico #442", hours: 12.0, type: "extra" },
                { date: "04/12", wday: "Qua", project: "Suporte N2", desc: "Monitoramento", hours: 8.0, type: "normal" },
            ],
            "default": [
                { date: "02/12", wday: "Seg", project: "Projeto Padr√£o", desc: "Desenvolvimento", hours: 8.0, type: "normal" },
                { date: "03/12", wday: "Ter", project: "Projeto Padr√£o", desc: "Reuni√£o de Status", hours: 8.0, type: "normal" }
            ]
        };

        // --- NAVEGA√á√ÉO SPA ---

        function navigate(viewName) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${viewName}`);
            if(activeNav) activeNav.classList.add('active');

            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-approval').classList.add('hidden');

            const view = document.getElementById(`view-${viewName}`);
            view.classList.remove('hidden');
            
            view.classList.remove('fade-in');
            void view.offsetWidth; 
            view.classList.add('fade-in');

            if (viewName === 'approval') renderApprovalCards();
        }

        // --- RENDERIZA√á√ÉO: APROVA√á√ÉO ---

        function renderApprovalCards() {
            const container = document.getElementById('approval-cards-container');
            container.innerHTML = '';

            approvalData.forEach(item => {
                const isHighOvertime = item.overtimeHours > 10;
                
                const card = `
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow flex flex-col h-full">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">${item.client}</span>
                            <h3 class="text-lg font-bold text-gray-900 mt-1">${item.serviceName}</h3>
                        </div>
                        <span class="bg-yellow-100 text-yellow-700 text-xs font-bold px-2 py-1 rounded">Aberto</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6 flex-1">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Horas Normais</p>
                            <p class="text-xl font-bold text-gray-800">${item.regularHours}h</p>
                        </div>
                        <div class="${isHighOvertime ? 'bg-red-50' : 'bg-gray-50'} p-3 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Horas Extras</p>
                            <p class="text-xl font-bold ${isHighOvertime ? 'text-red-600' : 'text-gray-800'}">${item.overtimeHours}h</p>
                            ${isHighOvertime ? '<p class="text-[10px] text-red-500 font-bold mt-1">‚ö† Aten√ß√£o</p>' : ''}
                        </div>
                    </div>

                    <div class="flex items-center justify-between pt-4 border-t border-gray-100 mt-auto">
                        <span class="text-xs text-gray-400 font-medium">${item.teamSize} Recurso(s) alocado(s)</span>
                        <div class="flex gap-2">
                            <button onclick="openModal(${item.serviceId}, '${item.serviceName}')" class="px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-blue-100">Analisar & Aprovar</button>
                        </div>
                    </div>
                </div>`;
                container.innerHTML += card;
            });
        }

        // --- MODAL N√çVEL 1: DETALHES DO SERVI√áO ---
        function openModal(serviceId, serviceName) {
            const modal = document.getElementById('details-modal');
            const title = document.getElementById('modal-title');
            const tbody = document.getElementById('modal-resources-body');
            
            title.innerText = serviceName || "Detalhes";

            tbody.innerHTML = '';
            const resources = serviceDetails[serviceId] || [];

            resources.forEach((res, index) => {
                let statusBadge = '';
                let rowClass = '';

                // Badges de Status do Recurso
                if (res.status === 'danger') {
                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Sobrecarregado (${res.total}h)</span>`;
                    rowClass = 'bg-red-50/50';
                } else if (res.status === 'warning') {
                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Alto HE (${res.overtime}h)</span>`;
                } else {
                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Conforme</span>`;
                }
                
                // L√≥gica de Bot√µes de A√ß√£o
                let actionArea;
                
                if (res.status_approval === 'approved') {
                    actionArea = `<span class="flex items-center justify-end text-green-600 text-xs font-bold gap-1"><i data-lucide="check" class="w-3 h-3"></i> Aprovado</span>`;
                } else if (res.status_approval === 'rejected') {
                    actionArea = `<span class="flex items-center justify-end text-red-600 text-xs font-bold gap-1"><i data-lucide="x" class="w-3 h-3"></i> Reprovado</span>`;
                } else {
                    // Estado Inicial: Bot√µes desabilitados se logs n√£o foram vistos
                    const isDisabled = !res.logs_viewed;
                    const opacityClass = isDisabled ? 'opacity-40 cursor-not-allowed' : 'hover:bg-green-700 hover:bg-red-700 cursor-pointer shadow-sm';
                    const disabledAttr = isDisabled ? 'disabled' : '';

                    actionArea = `
                        <div class="flex gap-2 justify-end" id="actions-${serviceId}-${index}">
                            <button onclick="rejectResource(${serviceId}, ${index}, this)" ${disabledAttr} class="px-3 py-1.5 bg-red-600 text-white text-xs font-bold rounded transition-colors ${opacityClass}">Reprovar</button>
                            <button onclick="approveResource(${serviceId}, ${index}, this)" ${disabledAttr} class="px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded transition-colors ${opacityClass}">Aprovar</button>
                        </div>
                    `;
                }

                const row = `
                    <tr class="hover:bg-gray-50 ${rowClass}">
                        <td class="px-6 py-4 font-medium text-gray-900">${res.name}</td>
                        <td class="px-6 py-4 text-gray-600">${res.total}h</td>
                        <td class="px-6 py-4 text-gray-600">${res.overtime}h</td>
                        <td class="px-6 py-4">${statusBadge}</td>
                        <td class="px-6 py-4 text-right">
                             <div class="flex items-center justify-end gap-3">
                                <button onclick="viewLogs(${serviceId}, ${index}, '${res.name}')" class="text-blue-600 hover:text-blue-800 text-xs font-bold underline cursor-pointer mr-2">Ver Extrato</button>
                                ${actionArea}
                             </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
            }, 10);
            
            lucide.createIcons();
        }

        // Fun√ß√£o Wrapper para Ver Logs e Habilitar Bot√µes
        function viewLogs(serviceId, index, name) {
            // Habilitar bot√µes na interface
            const actionsDiv = document.getElementById(`actions-${serviceId}-${index}`);
            if(actionsDiv) {
                const buttons = actionsDiv.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-40', 'cursor-not-allowed');
                    btn.classList.add('cursor-pointer', 'shadow-sm');
                    // Adicionar classes de hover espec√≠ficas baseado na cor original
                    if(btn.classList.contains('bg-green-600')) btn.classList.add('hover:bg-green-700');
                    if(btn.classList.contains('bg-red-600')) btn.classList.add('hover:bg-red-700');
                });
            }

            // Atualizar estado
            if(serviceDetails[serviceId] && serviceDetails[serviceId][index]) {
                serviceDetails[serviceId][index].logs_viewed = true;
            }

            // Abrir Modal de Logs
            openResourceLogs(name);
        }

        function approveResource(serviceId, resourceIndex, btnElement) {
            serviceDetails[serviceId][resourceIndex].status_approval = 'approved';
            
            // Substituir bot√µes por status
            const actionsContainer = document.getElementById(`actions-${serviceId}-${resourceIndex}`);
            actionsContainer.parentElement.innerHTML = `
                <span class="flex items-center justify-end text-green-600 text-xs font-bold gap-1 fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Aprovado
                </span>
            `;
        }

        function rejectResource(serviceId, resourceIndex, btnElement) {
            serviceDetails[serviceId][resourceIndex].status_approval = 'rejected';
            
            // Substituir bot√µes por status
            const actionsContainer = document.getElementById(`actions-${serviceId}-${resourceIndex}`);
            actionsContainer.parentElement.innerHTML = `
                <span class="flex items-center justify-end text-red-600 text-xs font-bold gap-1 fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    Reprovado
                </span>
            `;
        }

        function closeModal() {
            const modal = document.getElementById('details-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // --- MODAL N√çVEL 2: EXTRATO DO RECURSO (DRILL DOWN) ---
        function openResourceLogs(resourceName) {
            const modal = document.getElementById('resource-logs-modal');
            const tbody = document.getElementById('rl-logs-body');
            
            document.getElementById('rl-resource-name').innerText = resourceName;
            
            const logs = resourceLogsData[resourceName] || resourceLogsData['default'];

            const totalHours = logs.reduce((acc, curr) => acc + curr.hours, 0);
            const extraHours = logs.filter(l => l.type === 'extra' || l.hours > 8).reduce((acc, curr) => acc + (curr.hours > 8 ? curr.hours - 8 : 0), 0);
            
            document.getElementById('rl-total-hours').innerText = totalHours.toFixed(1) + 'h';
            document.getElementById('rl-overtime-hours').innerText = extraHours.toFixed(1) + 'h';

            tbody.innerHTML = '';
            logs.forEach(log => {
                const isExtra = log.hours > 8;
                const isUnder = log.hours < 8;
                
                let barColor = 'bg-blue-500';
                let hoursColor = 'text-gray-900';
                
                if (isExtra) { barColor = 'bg-red-400'; hoursColor = 'text-red-500 font-bold'; }
                if (isUnder) { barColor = 'bg-yellow-400'; }

                const widthPercentage = Math.min((log.hours / 12) * 100, 100);

                const row = `
                    <tr class="hover:bg-gray-50 border-b border-gray-50 last:border-0">
                        <td class="px-6 py-4">
                            <span class="block font-bold text-gray-800">${log.date}</span>
                            <span class="text-xs text-gray-400 uppercase">${log.wday}</span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <span class="font-bold text-xs text-blue-600 mb-1">${log.project}</span>
                                <span class="text-sm text-gray-600">${log.desc}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 align-middle">
                            <div class="w-full bg-gray-200 rounded-full h-1.5 overflow-hidden">
                                <div class="${barColor} h-1.5 rounded-full" style="width: ${widthPercentage}%"></div>
                            </div>
                            <div class="flex justify-between text-[10px] text-gray-400 mt-1">
                                <span>0h</span>
                                <span>8h</span>
                                <span>12h+</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-right">
                             <span class="text-lg ${hoursColor}">${log.hours.toFixed(1)}h</span>
                             ${isExtra ? '<span class="block text-[10px] text-red-400 font-bold">HE: ' + (log.hours - 8).toFixed(1) + 'h</span>' : ''}
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
            }, 10);
        }

        function closeResourceLogs() {
            const modal = document.getElementById('resource-logs-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function filterApprovals() {
            const container = document.getElementById('approval-cards-container');
            container.style.opacity = '0.5';
            setTimeout(() => {
                container.style.opacity = '1';
            }, 300);
        }

    </script>
</body>
</html>